<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Images to PDF Converter | ToolBox Tamil</title>
    <meta name="description" content="Convert multiple images to PDF online. Combine JPG, PNG, WebP images into a single PDF document.">
    <link rel="stylesheet" href="tools-common.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <style>
        /* Additional styles specific to Images to PDF */
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .image-item {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 15px;
            position: relative;
            cursor: move;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .image-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .image-item.dragging {
            opacity: 0.5;
            border-color: var(--primary-color);
        }

        .image-item.drag-over {
            border-color: var(--primary-color);
            background: rgba(255, 107, 107, 0.1);
        }

        .image-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .image-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .image-size {
            font-size: 12px;
            color: var(--text-light);
        }

        .remove-image {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .remove-image:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .image-order {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .pdf-options {
            background: var(--bg-color);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .option-group {
            display: flex;
            flex-direction: column;
        }

        .option-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        select, input[type="number"] {
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .radio-option label {
            cursor: pointer;
            font-weight: 500;
        }

        .custom-size-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .custom-size-inputs.hidden {
            display: none;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .images-empty {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .image-thumbnail {
                height: 150px;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="tool-header">
        <div class="container">
            <a href="../index.html" class="logo">
                <h1>Images to PDF</h1>
            </a>
            <a href="../index.html" class="back-btn">Back to Tools</a>
        </div>
    </div>

    <!-- Main Tool Section -->
    <div class="container">
        <div class="tool-section">
            <h2 class="tool-title">Images to PDF Converter</h2>
            <p class="tool-description">
                Convert multiple images to a single PDF document. Upload JPG, PNG, or WebP images, reorder them by dragging,
                choose your page size and orientation, then download your PDF.
            </p>

            <!-- Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üì∏</div>
                <div class="upload-text">Drop images here or click to upload</div>
                <div class="upload-subtext">Supports JPG, PNG, WebP formats</div>
                <input type="file" id="imageInput" accept="image/jpeg,image/jpg,image/png,image/webp" multiple>
            </div>

            <!-- PDF Options -->
            <div class="pdf-options" id="pdfOptions" style="display: none;">
                <h3 style="margin-bottom: 20px; color: var(--text-color);">PDF Settings</h3>
                <div class="options-grid">
                    <div class="option-group">
                        <label class="option-label">Page Size</label>
                        <select id="pageSizeSelect">
                            <option value="a4">A4 (210 x 297 mm)</option>
                            <option value="letter">Letter (8.5 x 11 in)</option>
                            <option value="legal">Legal (8.5 x 14 in)</option>
                            <option value="custom">Custom Size</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label class="option-label">Orientation</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="orientationPortrait" name="orientation" value="portrait" checked>
                                <label for="orientationPortrait">Portrait</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="orientationLandscape" name="orientation" value="landscape">
                                <label for="orientationLandscape">Landscape</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="custom-size-inputs hidden" id="customSizeInputs">
                    <div class="option-group">
                        <label class="option-label">Width (mm)</label>
                        <input type="number" id="customWidth" min="50" max="1000" value="210">
                    </div>
                    <div class="option-group">
                        <label class="option-label">Height (mm)</label>
                        <input type="number" id="customHeight" min="50" max="1000" value="297">
                    </div>
                </div>
            </div>

            <!-- Images Grid -->
            <div id="imagesContainer" style="display: none;">
                <h3 style="margin: 30px 0 15px 0; color: var(--text-color);">
                    Selected Images (Drag to reorder)
                </h3>
                <div class="images-grid" id="imagesGrid"></div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons" id="actionButtons" style="display: none;">
                <button class="btn btn-primary" id="generatePdfBtn">
                    üìÑ Generate PDF
                </button>
                <button class="btn btn-secondary" id="addMoreBtn">
                    ‚ûï Add More Images
                </button>
                <button class="btn btn-secondary" id="clearAllBtn">
                    üóëÔ∏è Clear All
                </button>
            </div>

            <!-- Progress -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Processing...</div>
            </div>

            <!-- Alert -->
            <div class="alert" id="alertBox"></div>

            <!-- Features -->
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">üîí</div>
                    <div class="feature-text">
                        <h3>100% Secure</h3>
                        <p>All processing happens in your browser. No uploads to servers.</p>
                    </div>
                </div>
                <div class="feature">
                    <div class="feature-icon">üéØ</div>
                    <div class="feature-text">
                        <h3>Custom Page Sizes</h3>
                        <p>Choose from A4, Letter, Legal, or set custom dimensions.</p>
                    </div>
                </div>
                <div class="feature">
                    <div class="feature-icon">‚ÜïÔ∏è</div>
                    <div class="feature-text">
                        <h3>Reorder Images</h3>
                        <p>Drag and drop images to arrange them in your preferred order.</p>
                    </div>
                </div>
                <div class="feature">
                    <div class="feature-icon">‚ö°</div>
                    <div class="feature-text">
                        <h3>Fast & Free</h3>
                        <p>Convert unlimited images to PDF instantly, completely free.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="tool-footer">
        <p>&copy; 2024 ToolBox Tamil. All rights reserved. | <a href="../index.html">More Tools</a></p>
    </div>

    <script>
        // Image to PDF Converter
        const { PDFDocument } = PDFLib;

        let selectedImages = [];

        // DOM Elements
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const imagesContainer = document.getElementById('imagesContainer');
        const imagesGrid = document.getElementById('imagesGrid');
        const pdfOptions = document.getElementById('pdfOptions');
        const actionButtons = document.getElementById('actionButtons');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const alertBox = document.getElementById('alertBox');
        const pageSizeSelect = document.getElementById('pageSizeSelect');
        const customSizeInputs = document.getElementById('customSizeInputs');
        const generatePdfBtn = document.getElementById('generatePdfBtn');
        const addMoreBtn = document.getElementById('addMoreBtn');
        const clearAllBtn = document.getElementById('clearAllBtn');

        // Upload Area Events
        uploadArea.addEventListener('click', () => imageInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(file =>
                file.type.startsWith('image/')
            );
            handleImageFiles(files);
        });

        imageInput.addEventListener('change', (e) => {
            handleImageFiles(Array.from(e.target.files));
        });

        // Add More Button
        addMoreBtn.addEventListener('click', () => imageInput.click());

        // Clear All Button
        clearAllBtn.addEventListener('click', () => {
            selectedImages = [];
            renderImages();
            imagesContainer.style.display = 'none';
            actionButtons.style.display = 'none';
            pdfOptions.style.display = 'none';
            imageInput.value = '';
            showAlert('All images cleared', 'success');
        });

        // Page Size Select
        pageSizeSelect.addEventListener('change', (e) => {
            if (e.target.value === 'custom') {
                customSizeInputs.classList.remove('hidden');
            } else {
                customSizeInputs.classList.add('hidden');
            }
        });

        // Generate PDF Button
        generatePdfBtn.addEventListener('click', generatePDF);

        // Handle Image Files
        function handleImageFiles(files) {
            if (files.length === 0) {
                showAlert('Please select at least one image', 'error');
                return;
            }

            const validFiles = files.filter(file => {
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
                return validTypes.includes(file.type);
            });

            if (validFiles.length === 0) {
                showAlert('Please select valid image files (JPG, PNG, WebP)', 'error');
                return;
            }

            validFiles.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    selectedImages.push({
                        file: file,
                        dataUrl: e.target.result,
                        name: file.name,
                        size: formatFileSize(file.size)
                    });
                    renderImages();
                };
                reader.readAsDataURL(file);
            });

            imagesContainer.style.display = 'block';
            actionButtons.style.display = 'flex';
            pdfOptions.style.display = 'block';
        }

        // Render Images
        function renderImages() {
            imagesGrid.innerHTML = '';

            if (selectedImages.length === 0) {
                imagesGrid.innerHTML = '<div class="images-empty">No images selected</div>';
                return;
            }

            selectedImages.forEach((image, index) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.draggable = true;
                imageItem.dataset.index = index;

                imageItem.innerHTML = `
                    <div class="image-order">${index + 1}</div>
                    <button class="remove-image" onclick="removeImage(${index})">√ó</button>
                    <img src="${image.dataUrl}" alt="${image.name}" class="image-thumbnail">
                    <div class="image-name" title="${image.name}">${image.name}</div>
                    <div class="image-size">${image.size}</div>
                `;

                // Drag and Drop Events
                imageItem.addEventListener('dragstart', handleDragStart);
                imageItem.addEventListener('dragover', handleDragOver);
                imageItem.addEventListener('drop', handleDrop);
                imageItem.addEventListener('dragend', handleDragEnd);
                imageItem.addEventListener('dragenter', handleDragEnter);
                imageItem.addEventListener('dragleave', handleDragLeave);

                imagesGrid.appendChild(imageItem);
            });
        }

        // Drag and Drop Handlers
        let draggedIndex = null;

        function handleDragStart(e) {
            draggedIndex = parseInt(e.currentTarget.dataset.index);
            e.currentTarget.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDragEnter(e) {
            if (e.currentTarget.classList.contains('image-item')) {
                e.currentTarget.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            if (e.currentTarget.classList.contains('image-item')) {
                e.currentTarget.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            const dropIndex = parseInt(e.currentTarget.dataset.index);

            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                const draggedItem = selectedImages[draggedIndex];
                selectedImages.splice(draggedIndex, 1);
                selectedImages.splice(dropIndex, 0, draggedItem);
                renderImages();
            }

            e.currentTarget.classList.remove('drag-over');
        }

        function handleDragEnd(e) {
            e.currentTarget.classList.remove('dragging');
            document.querySelectorAll('.image-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedIndex = null;
        }

        // Remove Image
        function removeImage(index) {
            selectedImages.splice(index, 1);
            renderImages();

            if (selectedImages.length === 0) {
                imagesContainer.style.display = 'none';
                actionButtons.style.display = 'none';
                pdfOptions.style.display = 'none';
            }
        }

        // Generate PDF
        async function generatePDF() {
            if (selectedImages.length === 0) {
                showAlert('Please select at least one image', 'error');
                return;
            }

            try {
                showProgress('Creating PDF...', 0);
                generatePdfBtn.disabled = true;

                // Create new PDF document
                const pdfDoc = await PDFDocument.create();

                // Get page dimensions
                const { width, height } = getPageDimensions();

                // Add each image to PDF
                for (let i = 0; i < selectedImages.length; i++) {
                    showProgress(`Adding image ${i + 1} of ${selectedImages.length}...`,
                        ((i + 1) / selectedImages.length) * 100);

                    const imageData = selectedImages[i].dataUrl;
                    let image;

                    // Embed image based on type
                    if (imageData.includes('image/png')) {
                        image = await pdfDoc.embedPng(imageData);
                    } else if (imageData.includes('image/jpeg') || imageData.includes('image/jpg')) {
                        image = await pdfDoc.embedJpg(imageData);
                    } else {
                        // Convert WebP to PNG using canvas
                        const pngData = await convertToPng(imageData);
                        image = await pdfDoc.embedPng(pngData);
                    }

                    // Create page
                    const page = pdfDoc.addPage([width, height]);

                    // Calculate image dimensions to fit page
                    const imageDims = image.scale(1);
                    const scale = Math.min(
                        width / imageDims.width,
                        height / imageDims.height
                    );

                    const scaledWidth = imageDims.width * scale;
                    const scaledHeight = imageDims.height * scale;

                    // Center image on page
                    const x = (width - scaledWidth) / 2;
                    const y = (height - scaledHeight) / 2;

                    page.drawImage(image, {
                        x: x,
                        y: y,
                        width: scaledWidth,
                        height: scaledHeight
                    });
                }

                // Save PDF
                showProgress('Saving PDF...', 100);
                const pdfBytes = await pdfDoc.save();

                // Download PDF
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `images-to-pdf-${Date.now()}.pdf`;
                a.click();
                URL.revokeObjectURL(url);

                hideProgress();
                showAlert('PDF created successfully!', 'success');
                generatePdfBtn.disabled = false;

            } catch (error) {
                console.error('Error generating PDF:', error);
                hideProgress();
                showAlert('Error creating PDF: ' + error.message, 'error');
                generatePdfBtn.disabled = false;
            }
        }

        // Get Page Dimensions
        function getPageDimensions() {
            const pageSize = pageSizeSelect.value;
            const orientation = document.querySelector('input[name="orientation"]:checked').value;

            let width, height;

            // Convert mm to points (1 mm = 2.83465 points)
            const mmToPoints = 2.83465;

            switch (pageSize) {
                case 'a4':
                    width = 210 * mmToPoints;
                    height = 297 * mmToPoints;
                    break;
                case 'letter':
                    width = 8.5 * 72; // inches to points
                    height = 11 * 72;
                    break;
                case 'legal':
                    width = 8.5 * 72;
                    height = 14 * 72;
                    break;
                case 'custom':
                    width = parseFloat(document.getElementById('customWidth').value) * mmToPoints;
                    height = parseFloat(document.getElementById('customHeight').value) * mmToPoints;
                    break;
                default:
                    width = 210 * mmToPoints;
                    height = 297 * mmToPoints;
            }

            // Swap dimensions for landscape
            if (orientation === 'landscape') {
                [width, height] = [height, width];
            }

            return { width, height };
        }

        // Convert WebP to PNG
        async function convertToPng(dataUrl) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = reject;
                img.src = dataUrl;
            });
        }

        // Format File Size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Show Progress
        function showProgress(message, percent) {
            progressContainer.classList.add('show');
            progressText.textContent = message;
            progressFill.style.width = percent + '%';
        }

        // Hide Progress
        function hideProgress() {
            progressContainer.classList.remove('show');
            progressFill.style.width = '0%';
        }

        // Show Alert
        function showAlert(message, type) {
            alertBox.textContent = message;
            alertBox.className = 'alert alert-' + type + ' show';
            setTimeout(() => {
                alertBox.classList.remove('show');
            }, 5000);
        }
    </script>
</body>
</html>
