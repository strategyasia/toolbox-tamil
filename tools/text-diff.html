<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Diff Checker - Toolbox Tamil</title>
    <link rel="stylesheet" href="tools-common.css">
    <style>
        /* Text Diff Specific Styles */
        .diff-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .text-input-group {
            display: flex;
            flex-direction: column;
        }

        .input-label {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 10px;
            font-size: 16px;
        }

        .textarea-wrapper textarea {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            padding: 16px;
            resize: vertical;
            min-height: 400px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .textarea-wrapper textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .textarea-wrapper.original textarea {
            background-color: rgba(81, 207, 102, 0.02);
        }

        .textarea-wrapper.modified textarea {
            background-color: rgba(255, 107, 107, 0.02);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin: 30px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            flex: 1;
            min-width: 150px;
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Diff Result Styles */
        .diff-result {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid var(--border-color);
        }

        .diff-result.show {
            display: block;
        }

        .diff-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(78, 205, 196, 0.1) 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
            font-family: 'Monaco', monospace;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-light);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card.additions {
            border-left: 4px solid #51CF66;
        }

        .stat-card.deletions {
            border-left: 4px solid #FF6B6B;
        }

        .stat-card.total {
            border-left: 4px solid #4ECDC4;
        }

        /* Diff View */
        .diff-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .diff-column {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }

        .diff-column-header {
            background: var(--bg-color);
            padding: 15px 20px;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .diff-column-header.original {
            color: #51CF66;
        }

        .diff-column-header.modified {
            color: #FF6B6B;
        }

        .diff-lines {
            max-height: 600px;
            overflow-y: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
        }

        .diff-line {
            display: flex;
            padding: 8px 15px;
            border-bottom: 1px solid #F0F0F0;
            align-items: flex-start;
            gap: 10px;
        }

        .diff-line-number {
            color: var(--text-light);
            user-select: none;
            min-width: 40px;
            text-align: right;
            font-weight: 500;
            opacity: 0.6;
        }

        .diff-line-content {
            flex: 1;
            word-break: break-all;
            white-space: pre-wrap;
        }

        .diff-line.added {
            background-color: rgba(81, 207, 102, 0.1);
        }

        .diff-line.added .diff-line-content {
            color: #2B8A3E;
            font-weight: 500;
        }

        .diff-line.removed {
            background-color: rgba(255, 107, 107, 0.1);
        }

        .diff-line.removed .diff-line-content {
            color: #C1121F;
            font-weight: 500;
        }

        .diff-line.unchanged {
            background-color: transparent;
        }

        .diff-line.unchanged .diff-line-content {
            color: var(--text-color);
        }

        /* Character-level diff highlighting */
        .char-added {
            background-color: #A3E4D7;
            font-weight: bold;
        }

        .char-removed {
            background-color: #FFB6C1;
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 18px;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .empty-state-subtext {
            font-size: 14px;
            color: var(--text-light);
        }

        .no-differences {
            background: rgba(81, 207, 102, 0.1);
            border: 2px solid #51CF66;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            color: #2B8A3E;
            font-weight: 600;
            font-size: 18px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin: 30px 0 20px 0;
            color: var(--text-color);
        }

        .summary-text {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            line-height: 1.8;
            color: var(--text-light);
        }

        /* Scrollbar Styling */
        .diff-lines::-webkit-scrollbar {
            width: 8px;
        }

        .diff-lines::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        .diff-lines::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .diff-lines::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .diff-container {
                grid-template-columns: 1fr;
            }

            .diff-view {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .textarea-wrapper textarea {
                min-height: 300px;
                font-size: 13px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .diff-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 24px;
            }

            .diff-lines {
                max-height: 400px;
            }
        }

        @media (max-width: 480px) {
            .diff-stats {
                grid-template-columns: 1fr;
            }

            .diff-lines {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="tool-header">
        <div class="container">
            <div class="logo">
                <span>üîç</span>
                <h1>Text Diff Checker</h1>
            </div>
            <a href="../index.html" class="back-btn">‚Üê Back to Home</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <section class="tool-section">
            <h2 class="tool-title">Text Diff Checker</h2>
            <p class="tool-description">
                Compare two versions of text side-by-side. Additions are highlighted in green, deletions in red, and the tool provides detailed statistics about the changes.
            </p>

            <!-- Input Section -->
            <div class="diff-container">
                <!-- Original Text -->
                <div class="text-input-group">
                    <label class="input-label">üìã Original Text</label>
                    <div class="textarea-wrapper original">
                        <textarea
                            id="originalText"
                            placeholder="Paste or type the original text here..."
                        ></textarea>
                    </div>
                </div>

                <!-- Modified Text -->
                <div class="text-input-group">
                    <label class="input-label">‚úèÔ∏è Modified Text</label>
                    <div class="textarea-wrapper modified">
                        <textarea
                            id="modifiedText"
                            placeholder="Paste or type the modified text here..."
                        ></textarea>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" id="compareBtn">
                    <span>üîÑ</span> Compare Texts
                </button>
                <button class="btn btn-secondary" id="clearBtn">
                    <span>üóëÔ∏è</span> Clear All
                </button>
                <button class="btn btn-secondary" id="swapBtn">
                    <span>üîÅ</span> Swap
                </button>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state">
                <div class="empty-state-icon">üìÑ</div>
                <div class="empty-state-text">Ready to compare texts</div>
                <div class="empty-state-subtext">Enter text in both fields and click "Compare Texts" to see the differences</div>
            </div>

            <!-- Diff Result Section -->
            <div id="diffResult" class="diff-result">
                <!-- Statistics -->
                <div class="diff-stats">
                    <div class="stat-card additions">
                        <div class="stat-value" id="addedCount">0</div>
                        <div class="stat-label">Lines Added</div>
                    </div>
                    <div class="stat-card deletions">
                        <div class="stat-value" id="deletedCount">0</div>
                        <div class="stat-label">Lines Deleted</div>
                    </div>
                    <div class="stat-card total">
                        <div class="stat-value" id="charDifference">0</div>
                        <div class="stat-label">Character Diff</div>
                    </div>
                    <div class="stat-card total">
                        <div class="stat-value" id="similarity">0%</div>
                        <div class="stat-label">Similarity</div>
                    </div>
                </div>

                <!-- Summary -->
                <div class="summary-text" id="summaryText"></div>

                <!-- Diff View -->
                <h3 class="section-title">Differences</h3>
                <div id="noDifferencesMessage" class="no-differences" style="display: none;">
                    ‚úì No differences found. Both texts are identical.
                </div>
                <div id="diffView" class="diff-view"></div>
            </div>
        </section>
    </main>

    <script>
        // DOM Elements
        const originalText = document.getElementById('originalText');
        const modifiedText = document.getElementById('modifiedText');
        const compareBtn = document.getElementById('compareBtn');
        const clearBtn = document.getElementById('clearBtn');
        const swapBtn = document.getElementById('swapBtn');
        const emptyState = document.getElementById('emptyState');
        const diffResult = document.getElementById('diffResult');
        const diffView = document.getElementById('diffView');
        const addedCount = document.getElementById('addedCount');
        const deletedCount = document.getElementById('deletedCount');
        const charDifference = document.getElementById('charDifference');
        const similarity = document.getElementById('similarity');
        const summaryText = document.getElementById('summaryText');
        const noDifferencesMessage = document.getElementById('noDifferencesMessage');

        /**
         * Myers Diff Algorithm - Simplified implementation for line-by-line comparison
         */
        function computeLinesDiff(originalLines, modifiedLines) {
            const result = [];
            const m = originalLines.length;
            const n = modifiedLines.length;

            // Create a 2D array for LCS (Longest Common Subsequence)
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (originalLines[i - 1] === modifiedLines[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                    }
                }
            }

            // Backtrack to find the diff
            let i = m, j = n;
            while (i > 0 || j > 0) {
                if (i > 0 && j > 0 && originalLines[i - 1] === modifiedLines[j - 1]) {
                    result.push({ type: 'unchanged', line: originalLines[i - 1], index: i - 1 });
                    i--;
                    j--;
                } else if (j > 0 && (i === 0 || dp[i][j - 1] >= dp[i - 1][j])) {
                    result.push({ type: 'added', line: modifiedLines[j - 1], index: j - 1 });
                    j--;
                } else if (i > 0) {
                    result.push({ type: 'removed', line: originalLines[i - 1], index: i - 1 });
                    i--;
                }
            }

            return result.reverse();
        }

        /**
         * Highlight character-level differences within lines
         */
        function highlightCharDifferences(line1, line2) {
            let result1 = '', result2 = '';
            const m = line1.length;
            const n = line2.length;

            // Create DP table for character-level LCS
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (line1[i - 1] === line2[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                    }
                }
            }

            // Backtrack
            let i = m, j = n;
            const matches = [];
            while (i > 0 && j > 0) {
                if (line1[i - 1] === line2[j - 1]) {
                    matches.push({ i: i - 1, j: j - 1 });
                    i--;
                    j--;
                } else if (j > 0 && dp[i][j - 1] >= dp[i - 1][j]) {
                    j--;
                } else {
                    i--;
                }
            }

            const matchSet = new Set(matches.map(m => `${m.i},${m.j}`));

            for (let k = 0; k < m; k++) {
                let found = false;
                for (const match of matches) {
                    if (match.i === k) {
                        found = true;
                        break;
                    }
                }
                result1 += found ? line1[k] : `<span class="char-removed">${escapeHtml(line1[k])}</span>`;
            }

            for (let k = 0; k < n; k++) {
                let found = false;
                for (const match of matches) {
                    if (match.j === k) {
                        found = true;
                        break;
                    }
                }
                result2 += found ? line2[k] : `<span class="char-added">${escapeHtml(line2[k])}</span>`;
            }

            return { highlighted1: result1, highlighted2: result2 };
        }

        /**
         * Escape HTML special characters
         */
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        /**
         * Compare texts and display differences
         */
        function compareTexts() {
            const original = originalText.value;
            const modified = modifiedText.value;

            if (!original.trim() && !modified.trim()) {
                showEmptyState();
                return;
            }

            // Split into lines
            const originalLines = original.split('\n');
            const modifiedLines = modified.split('\n');

            // Compute diff
            const diff = computeLinesDiff(originalLines, modifiedLines);

            // Calculate statistics
            let addedLines = 0, removedLines = 0;
            for (const item of diff) {
                if (item.type === 'added') addedLines++;
                if (item.type === 'removed') removedLines++;
            }

            const charDiff = Math.abs(original.length - modified.length);
            const totalChars = Math.max(original.length, modified.length);
            const similarChars = totalChars - charDiff;
            const sim = totalChars > 0 ? Math.round((similarChars / totalChars) * 100) : 100;

            // Update stats
            addedCount.textContent = addedLines;
            deletedCount.textContent = removedLines;
            charDifference.textContent = charDiff;
            similarity.textContent = sim + '%';

            // Update summary
            summaryText.innerHTML = `
                <strong>Comparison Summary:</strong> Found <strong>${addedLines}</strong> additions and <strong>${removedLines}</strong> deletions.
                Original text has <strong>${original.length}</strong> characters, modified has <strong>${modified.length}</strong> characters.
                Texts are <strong>${sim}%</strong> similar.
            `;

            // Check if no differences
            if (addedLines === 0 && removedLines === 0) {
                noDifferencesMessage.style.display = 'block';
                diffView.innerHTML = '';
            } else {
                noDifferencesMessage.style.display = 'none';
                renderDiff(diff, originalLines, modifiedLines);
            }

            emptyState.style.display = 'none';
            diffResult.classList.add('show');
        }

        /**
         * Render the diff view
         */
        function renderDiff(diff, originalLines, modifiedLines) {
            let originalContent = '<div class="diff-column-header original">Original</div><div class="diff-lines">';
            let modifiedContent = '<div class="diff-column-header modified">Modified</div><div class="diff-lines">';

            let origLineNum = 1;
            let modLineNum = 1;

            for (const item of diff) {
                if (item.type === 'unchanged') {
                    const escapedLine = escapeHtml(item.line);
                    originalContent += `<div class="diff-line unchanged"><span class="diff-line-number">${origLineNum}</span><span class="diff-line-content">${escapedLine}</span></div>`;
                    modifiedContent += `<div class="diff-line unchanged"><span class="diff-line-number">${modLineNum}</span><span class="diff-line-content">${escapedLine}</span></div>`;
                    origLineNum++;
                    modLineNum++;
                } else if (item.type === 'added') {
                    const escapedLine = escapeHtml(item.line);
                    modifiedContent += `<div class="diff-line added"><span class="diff-line-number">+${modLineNum}</span><span class="diff-line-content">${escapedLine}</span></div>`;
                    modLineNum++;
                } else if (item.type === 'removed') {
                    const escapedLine = escapeHtml(item.line);
                    originalContent += `<div class="diff-line removed"><span class="diff-line-number">-${origLineNum}</span><span class="diff-line-content">${escapedLine}</span></div>`;
                    origLineNum++;
                }
            }

            originalContent += '</div>';
            modifiedContent += '</div>';

            diffView.innerHTML = `
                <div class="diff-column">${originalContent}</div>
                <div class="diff-column">${modifiedContent}</div>
            `;
        }

        /**
         * Show empty state
         */
        function showEmptyState() {
            emptyState.style.display = 'block';
            diffResult.classList.remove('show');
            diffView.innerHTML = '';
        }

        /**
         * Clear all texts
         */
        function clearAll() {
            originalText.value = '';
            modifiedText.value = '';
            showEmptyState();
            originalText.focus();
        }

        /**
         * Swap texts
         */
        function swapTexts() {
            const temp = originalText.value;
            originalText.value = modifiedText.value;
            modifiedText.value = temp;

            if (diffResult.classList.contains('show')) {
                compareTexts();
            }
        }

        // Event Listeners
        compareBtn.addEventListener('click', compareTexts);
        clearBtn.addEventListener('click', clearAll);
        swapBtn.addEventListener('click', swapTexts);

        // Allow Enter+Shift to compare
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                compareTexts();
            }
        });

        // Initial state
        showEmptyState();
        originalText.focus();
    </script>
</body>
</html>
